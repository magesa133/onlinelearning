<!-- This template is for the assignment management page in the teacher dashboard. It includes a list of assignments, a search bar, and buttons to create, edit, or delete assignments. The layout is responsive and uses Bootstrap classes for styling. -->

{% block title %}Assignments{% endblock %}
{% extends 'teacher_dashboard.html' %}

{% block content %}
<div class="assignment-container">
    <div class="page-header">
        <div class="page-title">
            <h2>Assignment Management</h2>
            <p class="welcome-message">Create and manage assignments for your classes</p>
        </div>
        <a href="{{ url_for('create_assignment') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create New Assignment
        </a>
    </div>

    <div class="assignment-list">
        <div class="section-header">
            <h3>Your Assignments</h3>
            <div class="table-actions">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="assignmentSearch" placeholder="Search assignments...">
                </div>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="assignments-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Class</th>
                        <th>Subject</th>
                        <th>Due Date</th>
                        <th>Submissions</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assignment in assignments %}
                    <tr>
                        <td>{{ assignment.title }}</td>
                        <td>{{ assignment.classroom.class_name }}</td>
                        <td>{{ assignment.subject.name }}</td>
                        <td>{{ assignment.due_date.strftime('%d %b %Y %H:%M') }}</td>
                        <td>{{ assignment.submissions|length }}/{{ assignment.classroom.enrolled_students|length }}</td>
                        <td>
                            <span class="badge {{ 'badge-active' if assignment.is_active else 'badge-expired' }}">
                                {{ 'Active' if assignment.is_active else 'Expired' }}
                            </span>
                        </td>
                        <td class="actions">
                            <a href="{{ url_for('view_assignment', assignment_id=assignment.id) }}" class="btn-icon" title="View">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ url_for('edit_assignment', assignment_id=assignment.id) }}" class="btn-icon" title="Edit">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="{{ url_for('delete_assignment', assignment_id=assignment.id) }}" class="btn-icon danger" title="Delete" onclick="return confirm('Are you sure you want to delete this assignment?')">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="empty">No assignments created yet</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Base styles from previous templates remain */
    /* Add these additional styles */

    .assessment-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    .assessment-tabs {
        display: flex;
        border-bottom: 1px solid var(--light-gray);
        margin-bottom: 1.5rem;
    }

    .tab-btn {
        padding: 0.75rem 1.5rem;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        font-weight: 500;
        color: var(--medium-gray);
        cursor: pointer;
        transition: var(--transition);
    }

    .tab-btn.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }

    .tab-btn:hover:not(.active) {
        color: var(--dark-gray);
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    .questions-container {
        margin: 2rem 0;
        border-top: 1px solid var(--light-gray);
        padding-top: 1.5rem;
    }

    .section-title {
        margin-bottom: 1.5rem;
        color: var(--dark-gray);
    }

    .question-item {
        background: var(--light-gray);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .question-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .question-number {
        font-weight: 500;
        color: var(--dark-gray);
    }

    .question-options {
        margin: 1rem 0;
    }

    .option-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
    }

    .option-item input[type="text"] {
        flex: 1;
        padding: 0.5rem 1rem;
        border: 1px solid var(--medium-gray);
        border-radius: var(--radius);
    }

    .option-item input[type="radio"] {
        margin-right: 0.5rem;
    }

    .add-option, .add-question {
        margin-top: 0.5rem;
    }

    .badge {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .badge-quiz {
        background-color: rgba(111, 66, 193, 0.1);
        color: #6f42c1;
    }

    .badge-assignment {
        background-color: rgba(32, 201, 151, 0.1);
        color: #20c997;
    }

    .badge-active {
        background-color: rgba(40, 167, 69, 0.1);
        color: #28a745;
    }

    .badge-expired {
        background-color: rgba(220, 53, 69, 0.1);
        color: #dc3545;
    }

    .file-hint {
        font-size: 0.8rem;
        color: var(--medium-gray);
        margin-top: 0.5rem;
    }
</style>

<script>
    // Tab functionality
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove active class from all tabs and buttons
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Add active class to clicked tab
            this.classList.add('active');
            const tabId = this.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });

    // Quiz question management
    let questionCount = 1;
    let optionCounts = {1: 2}; // Track options per question

    // Add new question
    document.querySelector('.add-question').addEventListener('click', function() {
        questionCount++;
        optionCounts[questionCount] = 2; // Start with 2 options
        
        const newQuestion = document.createElement('div');
        newQuestion.className = 'question-item';
        newQuestion.setAttribute('data-question', questionCount);
        newQuestion.innerHTML = `
            <div class="question-header">
                <span class="question-number">Question ${questionCount}</span>
                <button type="button" class="btn-icon danger remove-question" title="Remove question">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            
            <div class="form-group">
                <input type="text" name="question_${questionCount}" class="question-text" required placeholder="Enter question text">
            </div>
            
            <div class="question-options">
                <div class="option-item">
                    <input type="radio" name="correct_answer_${questionCount}" value="1" required>
                    <input type="text" name="option_${questionCount}_1" class="option-text" required placeholder="Option 1">
                    <button type="button" class="btn-icon danger remove-option" title="Remove option">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="option-item">
                    <input type="radio" name="correct_answer_${questionCount}" value="2">
                    <input type="text" name="option_${questionCount}_2" class="option-text" required placeholder="Option 2">
                    <button type="button" class="btn-icon danger remove-option" title="Remove option">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <button type="button" class="btn btn-outline add-option">
                <i class="fas fa-plus"></i> Add Option
            </button>
        `;
        
        document.querySelector('.questions-container').appendChild(newQuestion);
        setupQuestionEvents(newQuestion);
    });

    // Add option to question
    function setupQuestionEvents(questionElement) {
        const questionNum = questionElement.getAttribute('data-question');
        
        questionElement.querySelector('.add-option').addEventListener('click', function() {
            optionCounts[questionNum]++;
            const optionNum = optionCounts[questionNum];
            
            const newOption = document.createElement('div');
            newOption.className = 'option-item';
            newOption.innerHTML = `
                <input type="radio" name="correct_answer_${questionNum}" value="${optionNum}">
                <input type="text" name="option_${questionNum}_${optionNum}" class="option-text" required placeholder="Option ${optionNum}">
                <button type="button" class="btn-icon danger remove-option" title="Remove option">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            questionElement.querySelector('.question-options').appendChild(newOption);
            setupOptionEvents(newOption);
        });
        
        questionElement.querySelector('.remove-question').addEventListener('click', function() {
            if (document.querySelectorAll('.question-item').length > 1) {
                questionElement.remove();
            } else {
                alert('A quiz must have at least one question');
            }
        });
        
        // Setup events for existing options
        questionElement.querySelectorAll('.remove-option').forEach(btn => {
            btn.addEventListener('click', function() {
                const optionItem = this.closest('.option-item');
                if (optionItem.closest('.question-options').querySelectorAll('.option-item').length > 2) {
                    optionItem.remove();
                } else {
                    alert('A question must have at least two options');
                }
            });
        });
    }

    // Setup events for initial question
    document.querySelectorAll('.question-item').forEach(question => {
        setupQuestionEvents(question);
    });

    // File upload handling for assignment
    const assignmentFileInput = document.getElementById('assignment-file');
    const assignmentFileInfo = document.getElementById('assignmentFileInfo');
    const assignmentDropArea = document.getElementById('assignmentDropArea');

    assignmentFileInput.addEventListener('change', (e) => {
        if (assignmentFileInput.files.length > 0) {
            assignmentFileInfo.textContent = assignmentFileInput.files[0].name;
            assignmentDropArea.classList.add('has-file');
        } else {
            assignmentFileInfo.textContent = 'No file selected';
            assignmentDropArea.classList.remove('has-file');
        }
    });

    // Drag and drop functionality (similar to previous implementation)
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        assignmentDropArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        assignmentDropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        assignmentDropArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        assignmentDropArea.classList.add('highlight');
    }

    function unhighlight() {
        assignmentDropArea.classList.remove('highlight');
    }

    assignmentDropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        assignmentFileInput.files = files;
        
        if (files.length > 0) {
            assignmentFileInfo.textContent = files[0].name;
            assignmentDropArea.classList.add('has-file');
        }
        
        const event = new Event('change');
        assignmentFileInput.dispatchEvent(event);
    }

    // Search functionality for assessments table
    document.getElementById('assessmentSearch').addEventListener('input', function() {
        const searchValue = this.value.toLowerCase();
        const rows = document.querySelectorAll('.assessments-table tbody tr');
        
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchValue) ? '' : 'none';
        });
    });
</script>
{% endblock %}